# Thermostat (ESPHome / ESP32-C3)

Конфигурация термостата для ESP32-C3 с:
- 2 нагревателями через реле;
- вентилятором для выравнивания температуры;
- 4 температурными датчиками (1 внешний, 2 основной процессный, 3/4 по объёму);
- каскадным ПИД-регулятором (внешний контур + внутренний контур);
- аварийным звуковым сигнализатором;
- резервным управлением при отказе второго датчика;
- логикой включения второго нагревателя по динамике нагрева (dT/dt).

## Файл конфигурации

- `esphome/thermostat_esp32c3.yaml`

## Логика работы

1. **Каскадный ПИД**
   - Внешний контур: регулирует по `Sensor 1 External` относительно `Target External Temperature`.
   - Внутренний контур: регулирует процессную температуру (`Sensor 2 Process`), либо резервную среднюю (`Sensor 3/4`) при аварии Sensor 2.

2. **Нагреватели**
   - `Heater 1 Relay`: основной, ШИМ по времени (time-proportional).
   - `Heater 2 Relay`: резервный/добавочный, включается при высокой потребности в нагреве и низкой скорости роста температуры (`dT/dt`) либо при аварии `Sensor 2`.

3. **Вентилятор**
   - Включается по разнице температур `|Sensor3 - Sensor4|` для выравнивания температуры по объёму.

4. **Аварийная сигнализация**
   - Срабатывает при отказе `Sensor 2` или при перегреве `Max Process Temperature`.
   - В аварии отключаются оба нагревателя и включается звуковой сигнализатор.

## Важно перед прошивкой

- Замените адреса DS18B20 (`address`) на реальные адреса ваших датчиков.
- Проверьте соответствие GPIO пинов вашей плате/обвязке.
- Заполните `secrets.yaml` (`wifi_ssid`, `wifi_password`).

## Запуск проверки конфигурации

```bash
esphome config esphome/thermostat_esp32c3.yaml
```
